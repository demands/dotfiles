#!/usr/bin/env bash

brew_prefix=$(brew --prefix)
dotfiles=$HOME/.dotfiles/
readonly brew_prefix dotfiles

pushd $dotfiles >/dev/null
echo "Updating dotfiles..."
git pull
popd >/dev/null

for tap in $(cat $dotfiles/hooks/taps); do
  brew tap $tap 2>/dev/null
done

for pkg in $(cat $dotfiles/hooks/packages); do
  if ! [ -d "$brew_prefix/opt/$pkg" ]; then
    brew install $pkg 2>/dev/null
  fi
done

for cask in $(cat $dotfiles/hooks/casks); do
  if ! [ -d "/opt/homebrew-cask/Caskroom/$cask/" ]; then
    brew cask install $cask
  fi
done
brew cask alfred link 2>/dev/null

echo "Updating brew packages and casks..."
brew update
brew upgrade

bash_location=/usr/local/bin/bash
if ! grep -q $bash_location /etc/shells; then
  echo "Setting $bash_location as default shell..."
  echo $bash_location | sudo tee -a /etc/shells > /dev/null
  chsh -s $bash_location
fi
